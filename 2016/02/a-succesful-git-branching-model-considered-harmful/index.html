<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>A succesful Git branching model considered harmful</title><meta name="description" content="   Update 2018-07. The branching model described here is called trunk based development. I and other people who I collaborated with did not know about the ar..."/><link rel="stylesheet" href="/css/main.css"/><link rel="canonical" href="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/"/><link rel="alternate" type="application/rss+xml" title="Jussi Judin's weblog" href="https://feeds.feedburner.com/jussijudin"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png"/><link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/icons/android-chrome-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96"/><link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/icons/manifest.json"/><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#00a300"/><meta name="msapplication-TileImage" content="/icons/mstile-144x144.png"/><meta name="theme-color" content="#ffffff"/><meta content="928229747232422" property="fb:app_id"/><meta content="Jussi Judin's weblog" property="og:site_name"/><meta content="A succesful Git branching model considered harmful" property="og:title"/><meta content="article" property="og:type"/><meta content="   Update 2018-07. The branching model described here is called trunk based development. I and other people who I collaborated with did not know about the articles that used this name. Nowadays there are excellent web resources about the subject, like trunkbaseddevelopment.com. They have a lot of..." property="og:description"/><meta content="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/" property="og:url"/><meta content="2016-02-07T18:00:01+02:00" property="article:published_time"/><meta content="https://barro.github.io/author/" property="article:author"/><meta property="og:image" content="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/id-cropped-800x400.png"/><meta content="git" property="article:tag"/><meta content="version-control" property="article:tag"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@b4rr0"/><meta name="twitter:creator" content="@b4rr0"/><meta name="twitter:title" content="A succesful Git branching model considered harmful"/><meta name="twitter:url" content="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/"/><meta name="twitter:description" content="   Update 2018-07. The branching model described here is called trunk based development. I and other people who I collaborated with did not know about the articles that used this name. Nowadays the..."/><meta name="twitter:image:src" content="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/id-square-400x400.png"/></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="/">Jussi Judin's weblog</a><nav class="site-nav"> <a href="#" class="menu-icon"> <svg viewBox="0 0 18 15"> <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/> <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/> <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/> </svg> </a><div class="trigger"> <a class="page-link" href="/archive/">Archive</a> <a class="page-link" href="/author/">Author</a> <a class="page-link" href="https://feeds.feedburner.com/jussijudin">RSS</a></div> </nav></div></header><div class="page-content"><div class="wrapper"><article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><meta itemprop="keywords" content="git,version-control"/> <span itemprop="publisher" itemscope="itemscope" itemtype="https://schema.org/Organization"> <span itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://barro.github.io/icons/parruki-60x60.png"/><meta itemprop="width" content="60"/><meta itemprop="height" content="60"/> </span><meta itemprop="name" content="ParruKi blog"/> </span><meta itemprop="description" content="Update 2018-07. The branching model described here is called trunk based development. I and other people who I collaborated with did not know about the articles that used this name. Nowadays there are excellent web resources about the subject, like..."/><meta itemscope="itemscope" itemprop="mainEntityOfPage" itemType="https://schema.org/WebPage" itemid="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/"/> <header class="post-header"><h1 class="post-title" itemprop="name headline">A succesful Git branching model considered harmful</h1><p class="post-meta"><time datetime="2016-02-07T18:00:01+02:00" itemprop="datePublished dateModified">Sunday, Feb 7, 2016</time> • <span itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"> <span itemprop="name">Jussi Judin</span> </span> • <a itemprop="image" itemscope="itemscope" itemtype="https://schema.org/ImageObject" href="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/id-cropped-800x400.png"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAIAAACr2KkGAAAABnRSTlMAAAAAAABupgeRAAAASUlEQVR4AWOAgwupG9AQXOrYhH8QBBfBJkUYLK8/QRANPweNOmjUQZjuIMZlmO4gyUGYUtR20KiDCINP03ZCEDFSBNIyPjTqIADrfkNtP8ARzgAAAABJRU5ErkJggg==" title="Article identicon" alt="Article identicon" width="48" height="12"/><meta itemprop="url" content="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/id-cropped-800x400.png"/><meta itemprop="width" content="800"/><meta itemprop="height" content="400"/> </a></p> </header><div class="post-content" itemprop="articleBody"><blockquote><p>Update 2018-07. The branching model described here is called trunk based development. I and other people who I collaborated with did not know about the articles that used this name. Nowadays there are excellent web resources about the subject, like <a href="https://trunkbaseddevelopment.com/">trunkbaseddevelopment.com</a>. They have a lot of material about this and other key subjects revolving around the area of efficient software development.</p></blockquote><p>When people start to use <a href="https://git-scm.com/">git</a> and get introduced to branches and to the ease of branching, they may do couple of Google searches and very often end up on a blog post about <a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>. The biggest issue with this article is that it comes up as one of the first ones in many git branching related searches when it should serve as a warning how not to use branches in software development.</p><h2 id="what-is-wrong-with-a-successful-git-branching-model">What is wrong with “A successful Git branching model”?</h2><p>To put it bluntly, this type of development approach where you use shared remote branches for everything and merge them back as they are is much more complicated than it should be. The basic principle in making usable systems is to have sane defaults. This branching model makes that mistake from the very beginning by not using the <code class="highlighter-rouge">master</code> branch for something that a developer who clones the repository would expect it to be used, development.</p><p>Using individual (long lived) branches for features also make it harder to ensure that everything works together when changes are merged back together. This is especially pronounced in today’s world where <a href="http://www.martinfowler.com/articles/continuousIntegration.html">continuous integration</a> should be the default practice of software development regardless how big the project is. By integrating all changes together regularly you’ll avoid big integration issues that waste a lot of time to resolve, especially for bigger projects with hundreds or thousands of developers. This type of development practice where every feature is developed in its own shared remote branch drives the process naturally towards big integration issues instead of avoiding them.</p><p>Also in “A successful Git branching model” merge commits are encouraged as the main method for integrating changes. I will explain next why merge commits are bad and what you will lose by using them.</p><h3 id="what-is-wrong-with-merge-commits">What is wrong with merge commits?</h3><p>“A successful Git branching model” talks how non-fast-forward merge commits can be thought as a way to keep all commits related to a certain feature nicely in one group. Then if you decide that a feature is not for you, you can just revert that one commit and have the whole feature removed. I would argue that this is a really rare situation that you revert a feature or that you even get it done completely right on the first try.</p><p>Merges in git very often create additional commits that begin with the message that looks like following: “<code class="highlighter-rouge">Merge branch 'some-branch' of git://git.some.domain/repository/</code>”. That does not provide any value when you want to see what has actually changed. You need go to the commit message and read what happens there, probably in the second paragraph. Not to mention going back in history to the branch and trying to see what happens in that branch.</p><p>Having non-linear history also makes <a href="https://git-scm.com/docs/git-bisect">git bisect</a> harder to do when issues are only revealed during integration. You may have both of the branches good individually but then the merge commit fails because your changes don’t conflict. This is not even that hard to encounter when one developer changes some internal interface and other developer builds something new based on the old interface definition. These kind of can be easy or hard to figure out, but having the history linear without any merge commits could immediately point out the commit that causes issues.</p><h2 id="something-more-simple">Something more simple</h2><figure class="pull-right text-center" id="figure-cactus-model"> <a href="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model.pdf"> <img src="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-100.png" alt="The cactus model" width="190px" height="538px" title="The cactus model" class="figure-image" srcset="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-100.png 1.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-125.png 1.25x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-150.png 1.5x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-200.png 2.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-300.png 3.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/cactus-model-400.png 4.0x"/> </a> <figcaption>Figure 1: The cactus model</figcaption> </figure><p>Let me show a much more simple alternative, that we can call the cactus model. It gets the name from the fact that all branches branch out from a wide trunk (<code class="highlighter-rouge">master</code> branch) and never get merged back. Cactus model should reflect much better the way that comes up naturally when working with git and making sure that continuous integration principles are used.</p><p>In <a href="#figure-cactus-model">figure 1</a> you can see the principle how the cactus branching model works and following sections explain the reasoning behind it. Some principles shown here may need <a href="https://www.gerritcodereview.com">Gerrit</a> or similar integrated code review and repository management system to be fully usable.</p><h3 id="all-development-happens-on-the-master-branch">All development happens on the master branch</h3><p><code class="highlighter-rouge">master</code> branch is the default that is checked out after <code class="highlighter-rouge">git clone</code>. So why not also have all development also happen there? No need to guess or needlessly document the development branch when it is the default one. This only applies to the central repository that is cloned and kept up to date by everyone. Individual developers are encouraged to use local branches for development but avoid shared remote branches.</p><p>Developers should <code class="highlighter-rouge">git rebase</code> their changes regularly so that their local branches would follow the latest <code class="highlighter-rouge">origin/master</code>. This is to make sure that we do not develop on an outdated baseline.</p><h4 id="using-local-branches">Using local branches</h4><p>Cactus model does not to discourage using branches when they are useful. Especially an individual developer should use short lived feature branches in their local repository and integrate them with the <code class="highlighter-rouge">origin/master</code> whenever there is something that can be shared with everyone else. Local branches are just to make it more easy to move between features while commits are tested or under code review.</p><p>Figures <a href="#figure-rebase-1">2</a> and <a href="#figure-rebase-2">3</a> show the basic principle of local branches and rebases by visualizing a tree state. In <a href="#figure-rebase-1">figure 2</a> we have a situation with two active local development branches (fuchsia circles) and one branch that is under code review (blue circles) and ready to be integrated to <code class="highlighter-rouge">origin/master</code> (yellow circles). In <a href="#figure-rebase-2">figure 3</a> we have updated the <code class="highlighter-rouge">origin/master</code> with two new commits (yellow-blue circles) and submitted two commits for code review (blue circle) and consider them to be ready for integration. As branches don’t automatically disappear from the repository, the integrated commits are still in the local repository (gray circles), but hopefully forgotten and ready to be <a href="https://git-scm.com/docs/git-gc">garbage collected</a>.</p><div class="text-center"> <figure class="inline-figure" id="figure-rebase-1"> <a href="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1.pdf"> <img src="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-100.png" alt="Local cactus branches" width="265" height="190" title="Local cactus branches" class="figure-image" srcset="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-100.png 1.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-125.png 1.25x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-150.png 1.5x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-200.png 2.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-300.png 3.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-1-400.png 4.0x"/> </a> <figcaption>Figure 2: Local development branches</figcaption> </figure> <figure class="inline-figure" id="figure-rebase-2"> <a href="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2.pdf"> <img src="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-100.png" alt="Local cactus after integration and rebase" width="328" height="190" class="figure-image" title="Local cactus after integration and rebase" srcset="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-100.png 1.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-125.png 1.25x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-150.png 1.5x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-200.png 2.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-300.png 3.0x, https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/rebase-2-400.png 4.0x"/> </a> <figcaption>Figure 3: Local branches after integration and rebase</figcaption> </figure></div><h4 id="shared-remote-branches">Shared remote branches</h4><p>As a main principle, shared remote branches should be avoided. All changes should be made available on <code class="highlighter-rouge">origin/master</code> and other developers should build their changes on top of that by continuously updating their working copies. This ensures that we do not end up in <a href="http://c2.com/xp/IntegrationHell.html">integration hell</a> that will happen when many feature branches need to be combined at once.</p><p>If you use staged code review system, like Gerrit or github, then you can just <code class="highlighter-rouge">git fetch</code> the commit chain and build on top of that. Then <code class="highlighter-rouge">git push</code> your changes to your own repository to some specific branch, that you have hopefully rebased on top of the <code class="highlighter-rouge">origin/master</code> before pushing.</p><h3 id="releases-are-branched-out-from-originmaster">Releases are branched out from origin/master</h3><p>Releases get their own tags or branches that are branched out from <code class="highlighter-rouge">origin/master</code>. In case we need a hotfix, just add that to the release branch and cherry-pick it to the master branch, if applicable. By using some specific tagging and branching naming scheme should enable for automatic releases but this should be completely invisible to developers in their daily work.</p><h3 id="there-are-only-fast-forward-merges">There are only fast-forward merges</h3><p><code class="highlighter-rouge">git merge</code> is not used. Changes go to <code class="highlighter-rouge">origin/master</code> by using <code class="highlighter-rouge">git rebase</code> or <code class="highlighter-rouge">git cherry-pick</code>. This avoids cluttering the repository with merge commits that do not really provide any real value and avoids <a href="http://stackoverflow.com/questions/14023648/why-does-my-git-history-look-like-a-christmas-tree">christmas tree look</a> on the repository. Rebasing also makes the history linear, so that <code class="highlighter-rouge">git bisect</code> is really easy to use for finding regressions.</p><p>If you are using Gerrit, you can also use cherry-pick submit strategy. This simply enables putting a collection of commits to <code class="highlighter-rouge">origin/master</code> at any desired order instead of having to settle for the order decided when commits were first put for a code review.</p><h2 id="concluding-remarks">Concluding remarks</h2><p>Git is really cool as a version control system. You can do all kinds of nifty stuff with it really easily that was hard or impossible to do. Branches are just <a href="https://git-scm.com/book/en/v1/Git-Internals-Git-References">pointers to certain commits</a> and that way you can create a branch really cheaply from anything. Also you can do all kinds of <a href="https://git-scm.com/docs/git-merge#_merge_strategies">fancy merges</a> and this makes using and mixing branches very easy. But as with all tools, branches should be used appropriately to make it more easy for developers to their daily development tasks, not harder by default.</p><p>I have also seen these kind of scary development practices to be used in projects with hundreds of developers when moving to git from some other version control systems. Some organizations even take this as far as they fully remove the <code class="highlighter-rouge">master</code> branch from the central repository and create all kinds of questions and obstacles by not having a sane default that is expected by anyone who has used git anywhere else.</p></div></article><div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://barro.github.io/2016/02/a-succesful-git-branching-model-considered-harmful/",this.page.identifier="/2016/02/a-succesful-git-branching-model-considered-harmful"};!function(){var e=document,i=e.createElement("script");i.src="//barro.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script></div></div><footer class="site-footer"><div class="wrapper"><h2 class="footer-heading">Jussi Judin's weblog</h2><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li>Jussi Judin</li><li>jju<span>din</span>+github <span>AT</span> iki DOT <span>f</span>i</li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li> <a href="https://github.com/barro" title="Barro">GitHub</a></li><li> <a href="https://bitbucket.org/barro" title="barro">Bitbucket</a></li><li> <a href="https://facebook.com/b4rr0" title="B4rr0">Facebook</a></li><li> <a href="https://twitter.com/B4rr0" title="@B4rr0">Twitter</a></li><li> <a href="https://plus.google.com/+JussiJudin-jj/" title="+JussiJudin-jj">Google+</a></li></ul></div><div class="footer-col footer-col-3"><p>Programming related topics. Maybe even some original content!</p></div></div></div></footer><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-71880517-1","auto"),ga("send","pageview")</script></body></html>