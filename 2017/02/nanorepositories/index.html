<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Nanorepositories</title><meta name="description" content="Small repositories that can not stand on their own that are just a part of some bigger project."/><link rel="stylesheet" href="/css/main.css"/><link rel="canonical" href="https://barro.github.io/2017/02/nanorepositories/"/><link rel="alternate" type="application/rss+xml" title="Jussi Judin's weblog" href="https://feeds.feedburner.com/jussijudin"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png"/><link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/icons/android-chrome-192x192.png" sizes="192x192"/><link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96"/><link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/icons/manifest.json"/><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#00a300"/><meta name="msapplication-TileImage" content="/icons/mstile-144x144.png"/><meta name="theme-color" content="#ffffff"/><meta content="928229747232422" property="fb:app_id"/><meta content="Jussi Judin's weblog" property="og:site_name"/><meta content="Nanorepositories" property="og:title"/><meta content="article" property="og:type"/><meta content="Small repositories that can not stand on their own that are just a part of some bigger project." property="og:description"/><meta content="https://barro.github.io/2017/02/nanorepositories/" property="og:url"/><meta content="2017-02-19T18:00:07+02:00" property="article:published_time"/><meta content="https://barro.github.io/author/" property="article:author"/><meta property="og:image" content="https://barro.github.io/2017/02/nanorepositories/id-cropped-800x400.png"/><meta content="source-control" property="article:tag"/><meta content="git" property="article:tag"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@b4rr0"/><meta name="twitter:creator" content="@b4rr0"/><meta name="twitter:title" content="Nanorepositories"/><meta name="twitter:url" content="https://barro.github.io/2017/02/nanorepositories/"/><meta name="twitter:description" content="Small repositories that can not stand on their own that are just a part of some bigger project."/><meta name="twitter:image:src" content="https://barro.github.io/2017/02/nanorepositories/id-square-400x400.png"/></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="/">Jussi Judin's weblog</a><nav class="site-nav"> <a href="#" class="menu-icon"> <svg viewBox="0 0 18 15"> <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/> <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/> <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/> </svg> </a><div class="trigger"> <a class="page-link" href="/archive/">Archive</a> <a class="page-link" href="/author/">Author</a> <a class="page-link" href="https://feeds.feedburner.com/jussijudin">RSS</a></div> </nav></div></header><div class="page-content"><div class="wrapper"><article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><meta itemprop="keywords" content="source-control,git"/> <span itemprop="publisher" itemscope="itemscope" itemtype="https://schema.org/Organization"> <span itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://barro.github.io/icons/parruki-60x60.png"/><meta itemprop="width" content="60"/><meta itemprop="height" content="60"/> </span><meta itemprop="name" content="ParruKi blog"/> </span><meta itemprop="description" content="Small repositories that can not stand on their own that are just a part of some bigger project."/><meta itemscope="itemscope" itemprop="mainEntityOfPage" itemType="https://schema.org/WebPage" itemid="https://barro.github.io/2017/02/nanorepositories/"/> <header class="post-header"><h1 class="post-title" itemprop="name headline">Nanorepositories</h1><p class="post-meta"><time datetime="2017-02-19T18:00:07+02:00" itemprop="datePublished dateModified">Sunday, Feb 19, 2017</time> • <span itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"> <span itemprop="name">Jussi Judin</span> </span> • <a itemprop="image" itemscope="itemscope" itemtype="https://schema.org/ImageObject" href="https://barro.github.io/2017/02/nanorepositories/id-cropped-800x400.png"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAIAAACr2KkGAAAABnRSTlMAAAAAAABupgeRAAAASklEQVR4AWNIFJhAEDEQAVbd/QZBeKR4pfsJolEHEUIIbbjcQX9AuYNGHWR8Nw6C4CKYUpgpBjNVUZaGRh1E/2yPkCIQMPjQqIMA0ldM7Lg9rh4AAAAASUVORK5CYII=" title="Article identicon" alt="Article identicon" width="48" height="12"/><meta itemprop="url" content="https://barro.github.io/2017/02/nanorepositories/id-cropped-800x400.png"/><meta itemprop="width" content="800"/><meta itemprop="height" content="400"/> </a></p> </header><div class="post-content" itemprop="articleBody"><p>I recently encountered a microservice antipattern called <a href="http://arnon.me/wp-content/uploads/2010/10/Nanoservices.pdf">nanoservice</a> that is described in following manner:</p><blockquote><p>Nanoservice is an Anti-pattern where a service is too fine grained. Nanoservice is a service whose overhead (communications, maintenance etc.) out-weights its utility.</p></blockquote><p>I have encountered a lot of similar situations with source code repositories where different parts of a program or a system that was shipped as a single entity were divided into smaller repositories. The code in these repositories was not used by anything else than the product (the unit of release) that the code was part of.</p><p>In the most extreme case there were thousands of smaller repositories. Many of those repositories were just holding less than 10 files in a deep directory hierarchy implementing some tiny functionality of the whole. Plus some boilerplate functionality for building and repository management that could just have been a couple of extra lines in a build system for a larger entity.</p><p>In more common cases, one product consists of dozens of smaller repositories where one or two repositories get over 90% of the whole weekly commit traffic and other repositories just get one commit here and there. Or that there are multiple interlinked repositories (see an example in <a href="http://baatz.io/posts/how-many-git-repos/">How many Git repos</a> article) that depend on each other and very often all of them need to go through the same interface changes.</p><p>Sometimes there also is a situation that all the work is done in smaller repositories and then there is one superproject[<a href="https://en.wikibooks.org/wiki/Git/Submodules_and_Superprojects">1</a>, <a href="http://svnbook.red-bean.com/en/1.7/svn.advanced.externals.html">2</a>, <a href="https://www.mercurial-scm.org/wiki/Subrepository">3</a>] that is automatically updated when a commit happens in any of its child projects. So basically you have one big repository that just consists of pointers to smaller repositories and has one unneeded layer of indirection. Also instead of making one commit that would reveal integration problems immediately, you now need to have multiple commits to reveal these issues. With some extra unneeded delay.</p><p>I would suggest calling these types of repositories nanorepositories. A nanorepository is a repository that holds a subsystem that is too limited to stand on its own and needs a bigger system to be part of. This bigger system usually is also the only system that is using this nanorepository. The nanorepository is also owned by the same organization as the larger entity it’s part of. Therefore it doesn’t give any advantages, for example, in access control. Nanorepositories can hold just couple of files, but they can also be relatively large applications that are, however, tightly coupled with the system they are part of.</p><h2 id="downsides-of-premature-repository-division">Downsides of premature repository division</h2><p>Nanorepositories are a case of premature optimization for code sharing where there is no real need for it. There are articles (<a href="http://danluu.com/monorepo/">Advantages of monolithic version control</a>, <a href="http://gregoryszorc.com/blog/2014/09/09/on-monolithic-repositories/">On Monolithic Repositories</a>) and presentations (<a href="https://www.youtube.com/watch?v=W71BTkUbdqE">Why Google Stores Billions of Lines of Code in a Single Repository</a>, <a href="https://www.youtube.com/watch?v=X0VH78ye4yY">F8 2015 - Big Code: Developer Infrastructure at Facebook’s Scale</a>) talking about the advantages of monolithic repositories, but those advantages can be hard to grasp without knowing the disadvantages of the other end.</p><p>I’ll list some issues that I have encountered when working with independent repositories. These all lead to a situation where developers need to spend extra time in repository management that could be avoided by grouping all software components that form the final product into one repository.</p><h3 id="expensive-interface-changes">Expensive interface changes</h3><p>Interface changes between components become expensive. You also need cumbersome interface deprecation policies and a way to support the old and new interface versions between repositories until the change has propagated everywhere. It can take months or years to ensure that all interface users have done the intended interface change. And if you don’t have a good search at your disposal, you still can’t be sure about it before you really remove the old interface.</p><p>With separate repositories it’s often the case that you can’t easily search where the interface you are deprecating is used at. This means that you don’t beforehand know what is actually depending on the interface. There naturally are search engines that span over multiple repositories, but they very rarely beat a simple <code class="highlighter-rouge">grep -r</code> (or <code class="highlighter-rouge">git grep</code>) command whose output you can further filter with simple command line tools. Especially if there are hundreds of small repositories that you need to include in your search.</p><h3 id="ignore-file-duplication">Ignore file duplication</h3><p>Often you need to add ignore files (<a href="https://git-scm.com/docs/gitignore"><code class="highlighter-rouge">.gitignore</code></a>, <a href="https://www.mercurial-scm.org/wiki/.hgignore"><code class="highlighter-rouge">.hgignore</code></a>, etc…) to prevent junk going in to the repository by accident. Situations that can generate junk next to your code can be for example:</p><ul><li>In-source build (versus <a href="http://voices.canonical.com/jussi.pakkanen/2013/04/16/why-you-should-consider-using-separate-build-directories/">separate build directories</a>) generated files (<code class="highlighter-rouge">*.a</code>, <code class="highlighter-rouge">*.o</code>, <code class="highlighter-rouge">*.exe</code>, <code class="highlighter-rouge">*.class</code>, <code class="highlighter-rouge">*.jar</code>…).</li><li>Using any editor that creates backup and other files next to the file you are editing (<code class="highlighter-rouge">*~</code>, <code class="highlighter-rouge">*.swp</code>, <code class="highlighter-rouge">*.bak</code>…).</li><li>Using interpreted languages, like Python, whose default implementation byte compile the scripts for faster start-up (<code class="highlighter-rouge">*.pyc</code>, <code class="highlighter-rouge">*.pyo</code>…).</li><li>Using integrated development environments that require their own project directories.</li></ul><p>All these generic ignore rules need to be included in every project in addition to project specific ignores. Other possibility is forcing these ignore rules on developers themselves instead of taking care of them centrally. In case of nanorepositories there likely is just one or two languages used per repository, so the amount of ignore rules likely depends on the development environment that the developers work with. But it’s still needless duplication when you could get by without.</p><h3 id="re-inventing-inefficient-build-system-rules">Re-inventing inefficient build system rules</h3><p>Small repositories lead into having to reinvent build system rules for every repository from scratch if you want to test and build your component in isolation. Or doing a lot of code duplication or including references to a repository including common build rules. This also applies for test runners, as different levels of testing for different languages usually have their own test runners. Sometimes multiple test runners per language, that all have some non-default options that provide various advantages in test result reporting.</p><p>Modern build systems like, <a href="https://ninja-build.org/">ninja</a> and <a href="http://bazel.io/">Bazel</a>, usually work on knowing the whole build graph of the system that they are trying to build. This makes it more easy to discover dependencies that only rebuild parts that are necessary to rebuild. Building every repository independently from each other leads into recursive build systems that treat their inputs as black boxes (<a href="https://www.yoctoproject.org/tools-resources/projects/bitbake">Bitbake</a>, <a href="https://www.npmjs.com/">npm</a>, <a href="https://maven.apache.org/">Maven</a>, <a href="https://www.gnu.org/software/make/">Make</a>…). Changes in these black boxes are either communicated with version number changes or always rebuilding the component in question. This leads into a wasteful process and resource usage when compared to <a href="https://trunkbaseddevelopment.com/">trunk based development</a> of monolithic repositories.</p><h3 id="overly-complicated-continuous-integration-machinery">Overly complicated continuous integration machinery</h3><p>One of the defining principles of modern software development is having a working continuous integration system in place. This ensures that independent changes also work when they leave developer’s machine and also work when they are integrated with the rest of the product that the change is part of. And this is done multiple times every day. This, combined with trunk based development, keeps integration issues short (minutes to days) and avoids <a href="https://wiki.debian.org/DebianReleases#Release_statistics">many-month release freezes</a> compared to branched or forked development methods.</p><p>Nanorepositories likely end up in a repository specific checks in the continuous integration machinery that only verify that the component in the repository itself works well. And if this continuous integration machinery has an automatic per repository check job generation, it likely needs to have an entry point (like <code class="highlighter-rouge">make test</code> or <code class="highlighter-rouge">test.sh</code> script) to execute those tests. And the same applies for compilation. Not to mention the extra work when trying to compile and test against different systems and runtime instrumentation (like <a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">AddressSanitizer</a>).</p><p>When the component finally gets integrated with everything else and the system breaks, figuring out the exact commit where the breakage happens (besides the integrating one) can be really painful. This is because it is easily possible to have dozens to thousands of commits between component releases. See a <a href="https://9gag.com/gag/a9rPY46">physical world example</a> where components work perfectly together, but fail when integrated. And its <a href="https://9gag.com/gag/appBmD8">hotfix</a>.</p><h2 id="a-case-for-small-repositories">A case for small repositories</h2><p>Nanorepositories should not be confused with small independent repositories, as not everything needs to aim to be a part of a bigger product. A very common reason for small repositories is the combination of ownership management with shareable components. Most open source projects are such that they are owned by a certain people, or an organization, and it’s just not a good case for them to be part of anything bigger. Especially if they provide independent components that really are used by multiple external entities. Same downsides, however, generally apply to a collection of open source projects as to products consisting of multiple repositories.</p><p><img src="https://barro.github.io/2017/02/nanorepositories/id-square-400x400.png" alt="Article identicon for Feedly" style="display:none" width="400" height="400" class="webfeedsFeaturedVisual"/></p></div></article><div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://barro.github.io/2017/02/nanorepositories/",this.page.identifier="/2017/02/nanorepositories"};!function(){var e=document,t=e.createElement("script");t.src="//barro.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script></div></div><footer class="site-footer"><div class="wrapper"><h2 class="footer-heading">Jussi Judin's weblog</h2><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li>Jussi Judin</li><li>jju<span>din</span>+github <span>AT</span> iki DOT <span>f</span>i</li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li> <a href="https://github.com/barro" title="Barro">GitHub</a></li><li> <a href="https://bitbucket.org/barro" title="barro">Bitbucket</a></li><li> <a href="https://facebook.com/b4rr0" title="B4rr0">Facebook</a></li><li> <a href="https://twitter.com/B4rr0" title="@B4rr0">Twitter</a></li><li> <a href="https://plus.google.com/+JussiJudin-jj/" title="+JussiJudin-jj">Google+</a></li></ul></div><div class="footer-col footer-col-3"><p>Programming related topics. Maybe even some original content!</p></div></div></div></footer><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-71880517-1","auto"),ga("send","pageview")</script></body></html>